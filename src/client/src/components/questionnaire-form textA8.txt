// üì¶ Importations en haut du fichier
// üß© React & React Hook Form
import { useNavigate } from "react-router-dom";
import React, { useState, useRef } from "react";
import { useForm, Controller } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

// üîÅ React Query
import { useMutation } from "@tanstack/react-query";

// üé® Ic√¥nes Lucide
import {
  User, Heart, Puzzle, Rocket, Brain, Building2,
  ArrowLeft, ArrowRight, Sparkles, Eye, Headphones,
  Hand, TreePine, Monitor, Wrench, Users, Plane, Book
} from "lucide-react";

// üß± UI Components
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import {
  Select, SelectContent, SelectItem,
  SelectTrigger, SelectValue
} from "@/components/ui/select";
import { Checkbox } from "@/components/ui/checkbox";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { Card, CardContent } from "@/components/ui/card";
// üß© Form Components
import { SelectObjet } from "@/components/form/SelectObjet";
import { SelectVideos } from "@/components/form/SelectVideos";
import { AppMagiqueInput } from "@/components/form/AppMagiqueInput";


// üîî Hooks & Utils
import { useToast } from "@/hooks/use-toast";
import { apiRequest } from "@/lib/queryClient";

// üì¶ Types & Schemas
import { orientationFormSchema, type OrientationFormData } from "@shared/schema";
import { type OrientationResults } from "../../../server/services/gemini";

function renderSection(title: string, data: Record<string, any>) {
  if (!data || typeof data !== "object") return null;

  return (
    <div className="mt-6">
      <h3 className="font-semibold text-lg mb-2">{title}</h3>
      <ul className="list-disc pl-6">
        {Object.entries(data).map(([key, value]) => (
          <li key={key}>
            <strong>{key.replaceAll("_", " ")} :</strong> {value}
          </li>
        ))}
      </ul>
    </div>
  );
}


// üß† Interface des props
  interface QuestionnaireFormProps {
  currentSection: number;
  totalSections: number;
  onSectionChange: (section: number) => void;
  onShowResults: (results: OrientationResults, profileId: string) => void;
  isLoading: boolean;
  setIsLoading: (loading: boolean) => void;
  }


// üöÄ Composant principal
export default function QuestionnaireForm({
  currentSection,
  totalSections,
  onSectionChange,
  onShowResults,
  isLoading,
  setIsLoading,
}: QuestionnaireFormProps) {
  const { toast } = useToast();
  const formRef = useRef<HTMLFormElement>(null);
  const [profil, setProfil] = useState<OrientationResults | null>(null);
  const navigate = useNavigate();




  const form = useForm<OrientationFormData>({
   // resolver: zodResolver(orientationFormSchema),
    defaultValues: {},
  });
  const generateProfileMutation = useMutation({
  mutationFn: async (data: OrientationFormData) => {
    console.log("üì§ Envoi des donn√©es √† l'API :", data);

    const response = await fetch(`${import.meta.env.VITE_API_URL}/api/orientation`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      throw new Error("Erreur lors de l'envoi du formulaire");
    }
    
	const profil = await response.json(); // ‚Üê ici tu re√ßois la vraie r√©ponse
    navigate("/resultats", { state: { profil } });
    return profil; // ‚úÖ tu renvoies le profil pour que onSuccess le re√ßoive
  },

  onSuccess: (data) => {
    console.log("‚úÖ R√©ponse du serveur :", data);
    console.log("üß™ R√©ponse re√ßue c√¥t√© frontend :", JSON.stringify(data, null, 2));

    // ‚úÖ V√©rification des cl√©s attendues
    const isProfilComplet =
      data &&
      typeof data === "object" &&
      data.analyse_profil &&
      Array.isArray(data.recommandations_carrieres) &&
      typeof data.conseils_generaux === "object";

    console.log("üîç V√©rification des cl√©s :", {
      analyse_profil: !!data.analyse_profil,
      recommandations_carrieres: !!data.recommandations_carrieres,
      conseils_generaux: !!data.conseils_generaux
    });

    if (!isProfilComplet) {
      toast({
        title: "R√©ponse incompl√®te",
        description: "Le serveur a r√©pondu, mais certaines donn√©es sont manquantes.",
        status: "warning",
        duration: 9000,
        isClosable: true,
      });
      return;
    }

    // ‚úÖ Stockage du profil
    setProfil(data);

    const hasCareers = data.recommandations_carrieres.length > 0;
    const hasProfileText = data.analyse_profil && Object.keys(data.analyse_profil).length > 0;


    if (hasCareers && hasProfileText) {
      onShowResults(data.recommandations_carrieres, data.analyse_profil);

      toast({
        title: "Profil g√©n√©r√© avec succ√®s ! üéâ",
        description: `Analyse disponible pour ${data.prenom ?? "l'utilisateur"}.`,
        status: "success",
        duration: 9000,
        isClosable: true,
      });
    }
  },

  onError: (error) => {
    console.error("‚ùå Erreur c√¥t√© frontend :", error);
    toast({
      title: "Erreur",
      description: "Impossible de g√©n√©rer ton profil. R√©essaie plus tard.",
      variant: "destructive",
    });
  },

  onSettled: () => {
    setIsLoading(false);
  }
});

const {
  register,
  handleSubmit,
  control,
  setValue,
  watch,
  formState: { errors },
} = useForm<OrientationFormData>({
  resolver: zodResolver(orientationFormSchema),
});

const onSubmit = async (data: OrientationFormData) => {
  console.log("‚úÖ Formulaire soumis :", data);
  setIsLoading(true);
  generateProfileMutation.mutate(data);
};

return (
  <form onSubmit={handleSubmit(onSubmit)}>
    {/* tes champs ici */}
    <Button type="submit">Envoyer</Button>
  </form>
);




// ‚úÖ Ensuite, tu peux d√©clarer onSubmi (handleSubmit) en dehors
const onSubmit = async (data: OrientationFormData) => {
  console.log("‚úÖ Formulaire soumis :", data);
  console.log("Genre s√©lectionn√© :", data.genre);
  setIsLoading(true);
  generateProfileMutation.mutate(data);
};

// ‚úÖ Et nextSection reste tel quel
const nextSection = () => {
  if (currentSection < totalSections) {
    onSectionChange(currentSection + 1);
    scrollToSection(currentSection + 1);
  }
};



  const prevSection = () => {
    if (currentSection > 1) {
      onSectionChange(currentSection - 1);
      scrollToSection(currentSection - 1);
    }
  };

  const scrollToSection = (section: number) => {
    const element = document.querySelector(`[data-section="${section}"]`);
    if (element) {
      element.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  };

const checkboxOptions = {
  interet: [
    { value: "Musique", label: "üéµ Musique" },
    { value: "Dessin", label: "üé® Dessin" },
    { value: "Technologie", label: "üíª Technologie" },
    { value: "Animaux", label: "üêï Animaux" },
    { value: "Lecture", label: "üìö Lecture" },
    { value: "Jeux vid√©o", label: "üéÆ Jeux vid√©o" },
    { value: "√âcologie", label: "üå± √âcologie" },
  ],
  competence: [
    { value: "Math√©matiques", label: "üî¢ Math√©matiques" },
    { value: "Expression √©crite", label: "‚úçÔ∏è Expression √©crite" },
    { value: "Sciences naturelles", label: "üî¨ Sciences naturelles" },
    { value: "Langues √©trang√®res", label: "üåç Langues √©trang√®res" },
    { value: "Informatique", label: "üíª Informatique" },
    { value: "Communication orale", label: "üó£Ô∏è Communication orale" },
    { value: "R√©solution de probl√®mes", label: "üß† R√©solution de probl√®mes" },
    { value: "Cr√©ativit√© artistique", label: "üé® Cr√©ativit√© artistique" },
    { value: "Sport", label: "‚öΩ Sport" },
  ],
  talent: [
    { value: "Communication", label: "Communication" },
    { value: "Apaiser les conflits", label: "Apaiser les conflits" },
    { value: "Organiser des sorties", label: "Organiser des sorties" },
    { value: "√ätre un bon confident", label: "√ätre un bon confident" },
    { value: "Imagination d√©bordante", label: "Imagination d√©bordante" },
    { value: "Dessiner", label: "Dessiner" },
    { value: "√âcrire", label: "√âcrire" },
    { value: "Musique", label: "Musique" },
    { value: "Solutions originales", label: "Solutions originales" },
    { value: "√Ä l'aise avec les mains", label: "√Ä l'aise avec les mains" },
    { value: "Monter des meubles", label: "Monter des meubles" },
    { value: "R√©parer", label: "R√©parer" },
    { value: "Cuisiner", label: "Cuisiner" },
    { value: "S'occuper des animaux", label: "S'occuper des animaux" },
    { value: "Puzzles", label: "Puzzles" },
    { value: "Comprendre comment les choses fonctionnent", label: "Comprendre le fonctionnement" },
    { value: "Logique complexe", label: "Logique complexe" },
  ],
  motivation: [
    { value: "Cr√©er", label: "üé® Cr√©er" },
    { value: "Aider", label: "ü§ù Aider" },
    { value: "R√©soudre", label: "üß© R√©soudre" },
    { value: "Collaborer", label: "üë• Collaborer" },
    { value: "Autre", label: "‚ú® Autre" },
  ],
  apprentissageStyle: [
    { value: "Visuel", label: "Visuel", icon: Eye },
    { value: "Auditif", label: "Auditif", icon: Headphones },
    { value: "Kinesth√©sique", label: "Kinesth√©sique", icon: Hand },
  ],
  environnement: [
    { value: "En ext√©rieur", label: "En ext√©rieur", icon: TreePine },
    { value: "Bureau", label: "Bureau", icon: Monitor },
    { value: "Atelier", label: "Atelier", icon: Wrench },
    { value: "Public", label: "Public", icon: Users },
    { value: "D√©placement", label: "D√©placement", icon: Plane },
  ],
  valeurs_generales: [
    { value: "Honn√™tet√©", label: "üíé Honn√™tet√©" },
    { value: "Respect", label: "ü§ù Respect" },
    { value: "Tol√©rance", label: "üåà Tol√©rance" },
    { value: "Empathie", label: "üíó Empathie" },
    { value: "Innovation", label: "üî¨ Innovation" },
    { value: "Respect de l'environnement", label: "üå± Respect de l'environnement" },
    { value: "Autre", label: "‚ú® Autre" },
  ],
  connaissance: [
    { value: "Math√©matiques", label: "üî¢ Math√©matiques" },
    { value: "Histoire", label: "üìö Histoire" },
    { value: "Biologie", label: "üß¨ Biologie" },
    { value: "Informatique", label: "üíª Informatique" },
    { value: "Langues", label: "üåç Langues" },
  ],
};

console.log("üîé Profil dans le render :", profil);
console.log("‚úÖ Recommandations :", profil?.recommandations_carrieres);

return (
    <div className="max-w-4xl mx-auto px-4 pb-24">
     // <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-8">
	 {form.formState.errors.age && (
  <p className="text-red-500 text-sm mt-1">
    {form.formState.errors.age.message}
  </p>
)}
 

 {/* üëá C‚Äôest ici que tu vas ins√©rer l‚Äôaffichage du profil JSX*/}
{profil && (
  <Card
    className="shadow-xl border-l-4 border-green-500 transition-all duration-500 mt-12"
    data-section="r√©sultat"
  >
<CardContent className="p-8">
  <div className="flex items-center mb-6">
    <div className="w-12 h-12 bg-gradient-to-r from-green-500 to-green-700 rounded-full flex items-center justify-center mr-4">
      <Sparkles className="text-white h-6 w-6" />
    </div>
    <h2 className="text-2xl font-bold text-gray-900 dark:text-white">
      üß† Profil d‚Äôorientation pour {form.getValues("prenom") || "l'utilisateur"}
    </h2>
  </div>

	  {renderSection("üìù Analyse du profil", profil.analyse_profil)}
      {renderSection("üîç Hypoth√®ses g√©n√©rales", profil.hypotheses_generales)}
      {renderSection("üí° Conseils g√©n√©raux", profil.conseils_generaux)}
	  

{Array.isArray(profil.recommandations_carrieres) && (
  <div className="mb-6">
    <h3 className="font-semibold text-lg mb-2">üíº Recommandations de carri√®re</h3>
    <div className="space-y-4">
      {profil.recommandations_carrieres.map((metier, index) => (
        <div key={index} className="p-4 border rounded-lg shadow-sm bg-white dark:bg-gray-800">
          <h4 className="text-xl font-bold mb-2">üîπ {metier.titre}</h4>
          <p className="mb-2">{metier.description}</p>
          {metier.pourquoi_innovant_non_traditionnel && (
            <p className="italic text-sm text-gray-600 mb-2">
              üí° Pourquoi c‚Äôest innovant : {metier.pourquoi_innovant_non_traditionnel}
            </p>
          )}
          {Array.isArray(metier.lien_profil) && (
            <ul className="list-disc pl-6 mb-2">
              {metier.lien_profil.map((lien, i) => (
                <li key={i}>{lien}</li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </div>
  </div>
)}

    </CardContent>
  </Card>
)}

		
		
   {/* Section 1: Identity & Context */}
        <Card 
          className={`shadow-xl border-l-4 border-primary transition-all duration-500 ${
            currentSection === 1 ? 'form-section active' : 'form-section'
          }`}
          data-section="1"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center mr-4">
                <User className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üéØ Identit√© & Contexte</h2>
            </div>

            <div>
             <Label htmlFor="prenom">Pr√©nom</Label>
             <Input
               id="prenom"
              type="text"
               placeholder="Ex : L√©a"
               {...form.register("prenom")}
             />
           </div>


            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <Label htmlFor="age">√Çge</Label>
                <Input
                  id="age"
                  type="number"
                  min="10"
                  max="25"
                  placeholder="Ex : 15"
                  {...form.register("age", { valueAsNumber: true })}
                />
              </div>
              
              <div>
<label htmlFor="genre">Genre</label>
<select {...form.register("genre")} id="genre" className="w-full border rounded px-3 py-2">
  <option value="">S√©lectionner...</option>
  <option value="homme">Homme</option>
  <option value="femme">Femme</option>
  <option value="non-binaire">Non-binaire</option>
  <option value="autre">Autre</option>
</select>
              </div>
              
              <div>
                <Label htmlFor="mobilite">Localisation / Mobilit√©</Label>
                <Input
                  id="mobilite"
                  placeholder="Ex : Paris, Lyon, Marseille‚Ä¶"
                  {...form.register("mobilite")}
                />
              </div>
              
              <div>
<label htmlFor="disponibilite">Disponibilit√©</label>
<select {...form.register("disponibilite")} id="disponibilite" className="w-full border rounded px-3 py-2">
  <option value="">S√©lectionner...</option>
  <option value="temps-plein">Temps plein</option>
  <option value="temps-partiel">Temps partiel</option>
  <option value="freelance">Freelance</option>
  <option value="stage">Stage</option>
  <option value="alternance">Alternance</option>
</select>

              </div>
            </div>

            <div className="mt-6">
              <Label htmlFor="argent">Si l'argent n'√©tait pas un probl√®me, que ferais-tu ?</Label>
              <Textarea
                id="argent"
                rows={3}
                placeholder="D√©cris ta journ√©e id√©ale‚Ä¶"
                {...form.register("argent")}
              />
            </div>

            <div className="mt-6">
              <Label htmlFor="citation">Citation ou devise personnelle</Label>
              <Input
                id="citation"
                placeholder="Ex : 'Rien n'est impossible'"
                {...form.register("citation")}
              />
            </div>
          </CardContent>
        </Card>

    {/* Section 2: Passions & Interests */}
        <Card 
          className={`shadow-xl border-l-4 border-secondary transition-all duration-500 ${
            currentSection === 2 ? 'form-section active' : 'form-section'
          }`}
          data-section="2"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-secondary to-accent rounded-full flex items-center justify-center mr-4">
                <Heart className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">‚ù§Ô∏è Passions & Centres d'int√©r√™t</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Adolescents explorant leurs passions cr√©atives" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="space-y-4 mb-6">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200">Top 5 de tes passions</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <Input placeholder="üéØ Passion 1" {...form.register("passion1")} />
                <Input placeholder="üéØ Passion 2" {...form.register("passion2")} />
                <Input placeholder="üéØ Passion 3" {...form.register("passion3")} />
                <Input placeholder="üéØ Passion 4" {...form.register("passion4")} />
                <Input placeholder="üéØ Passion 5" {...form.register("passion5")} />
              </div>
            </div>

            <div className="mb-6">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Centres d'int√©r√™t</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                {checkboxOptions.interet.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`interet-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("interet") || [];
                        if (checked) {
                          form.setValue("interet", [...current, option.value]);
                        } else {
                          form.setValue("interet", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`interet-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>
     {/*Remplac√©*/}

          </CardContent>
        </Card>

      <Card>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <SelectObjet
              value={watch("objet")}
              onChange={(val) => setValue("objet", val)}
             error={errors.objet?.message}
            />

            <SelectVideos
              value={watch("videos")}
              onChange={(val) => setValue("videos", val)}
              error={errors.videos?.message}
            />

            <AppMagiqueInput
              value={watch("appMagique")}
              onChange={(val) => setValue("appMagique", val)}
              error={errors.appMagique?.message}
            />
          </div>
        </CardContent>
      </Card>


     {/* Section 3: Skills & Talents */}
        <Card 
          className={`shadow-xl border-l-4 border-accent transition-all duration-500 ${
            currentSection === 3 ? 'form-section active' : 'form-section'
          }`}
          data-section="3"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-accent to-primary rounded-full flex items-center justify-center mr-4">
                <Puzzle className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üß© Comp√©tences & Talents</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Jeunes d√©veloppant leurs comp√©tences techniques" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="mb-8">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Comp√©tences techniques ou scolaires</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                {checkboxOptions.competence.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`competence-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("competence") || [];
                        if (checked) {
                          form.setValue("competence", [...current, option.value]);
                        } else {
                          form.setValue("competence", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`competence-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>

            <div>
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Talents naturels</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                {checkboxOptions.talent.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`talent-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("talent") || [];
                        if (checked) {
                          form.setValue("talent", [...current, option.value]);
                        } else {
                          form.setValue("talent", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`talent-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>

      {/* Section 4: Motivations & Aspirations */}
        <Card 
          className={`shadow-xl border-l-4 border-purple-500 transition-all duration-500 ${
            currentSection === 4 ? 'form-section active' : 'form-section'
          }`}
          data-section="4"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-4">
                <Rocket className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üöÄ Motivations & Aspirations</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Jeunes motiv√©s travaillant ensemble" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="mb-8">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Ce qui te motive le plus</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                {checkboxOptions.motivation.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`motivation-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("motivation") || [];
                        if (checked) {
                          form.setValue("motivation", [...current, option.value]);
                        } else {
                          form.setValue("motivation", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`motivation-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>

            <div className="space-y-6">
              <div>
                <Label htmlFor="aspirations">Objectifs ou aspirations</Label>
                <Textarea
                  id="aspirations"
                  rows={3}
                  placeholder="Raconte-nous tes r√™ves et ambitions..."
                  {...form.register("aspirations")}
                />
              </div>

              <div>
                <Label htmlFor="inspirations">Sujets ou personnes qui t'inspirent (et pourquoi)</Label>
                <Textarea
                  id="inspirations"
                  rows={3}
                  placeholder="Qui sont tes h√©ros ? Qu'est-ce qui te passionne ?"
                  {...form.register("inspirations")}
                />
              </div>

              <div>
                <Label htmlFor="apprentissage">Ce que tu aimes apprendre en dehors de l'√©cole</Label>
                <Textarea
                  id="apprentissage"
                  rows={3}
                  placeholder="Tes apprentissages pr√©f√©r√©s en dehors des cours..."
                  {...form.register("apprentissage")}
                />
              </div>
            </div>
          </CardContent>
        </Card>


      {/* Section 5: Learning Style */}
        <Card 
          className={`shadow-xl border-l-4 border-indigo-500 transition-all duration-500 ${
            currentSection === 5 ? 'form-section active' : 'form-section'
          }`}
          data-section="5"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-full flex items-center justify-center mr-4">
                <Brain className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üß† Style d'apprentissage</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Diff√©rents styles d'apprentissage pour jeunes" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div>
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Quel est ton style d'apprentissage pr√©f√©r√© ?</h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {checkboxOptions.apprentissageStyle.map((option) => {
                  const IconComponent = option.icon;
                  return (
                    <Card key={option.value} className="border-2 hover:border-indigo-500 transition-colors cursor-pointer">
                      <CardContent className="p-6">
                        <div className="flex flex-col items-center text-center">
                          <Checkbox
                            id={`apprentissageStyle-${option.value}`}
                            className="mb-3"
                            onChange={(checked) => {
                              const current = form.getValues("apprentissageStyle") || [];
                              if (checked) {
                                form.setValue("apprentissageStyle", [...current, option.value]);
                              } else {
                                form.setValue("apprentissageStyle", current.filter(v => v !== option.value));
                              }
                            }}
                          />
                          <IconComponent className="h-8 w-8 text-indigo-500 mb-2" />

                        </div>
                      </CardContent>
                    </Card>
                  );
                })}
              </div>
            </div>
          </CardContent>
        </Card>

      {/* Section 6: Work Environment */}
        <Card 
          className={`shadow-xl border-l-4 border-teal-500 transition-all duration-500 ${
            currentSection === 6 ? 'form-section active' : 'form-section'
          }`}
          data-section="6"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-teal-500 to-green-500 rounded-full flex items-center justify-center mr-4">
                <Building2 className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üèûÔ∏è Environnement de travail pr√©f√©r√©</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Diff√©rents environnements de travail modernes" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="mb-8">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">O√π te sens-tu le plus √† l'aise pour travailler ?</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {checkboxOptions.environnement.map((option) => {
                  const IconComponent = option.icon;
                  return (
                    <Card key={option.value} className="border-2 hover:border-teal-500 transition-colors cursor-pointer">
                      <CardContent className="p-6">
                        <div className="flex flex-col items-center text-center">
                          <Checkbox
                            id={`environnement-${option.value}`}
                            className="mb-3"
                            onChange={(checked) => {
                              const current = form.getValues("environnement") || [];
                              if (checked) {
                                form.setValue("environnement", [...current, option.value]);
                              } else {
                                form.setValue("environnement", current.filter(v => v !== option.value));
                              }
                            }}
                          />
                          <IconComponent className="h-8 w-8 text-teal-500 mb-2" />
                          <Label htmlFor={`environnement-${option.value}`} className="font-medium">
                            {option.label}
                          </Label>
                        </div>
                      </CardContent>
                    </Card>
                  );
                })}
              </div>
            </div>

            <div>
<label htmlFor="teletravail">Pr√©f√©rence t√©l√©travail</label>
<select {...form.register("teletravail")} id="teletravail" className="w-full border rounded px-3 py-2">
  <option value="">S√©lectionner...</option>
  <option value="oui">Oui</option>
  <option value="non">Non</option>
  <option value="mixte">Mixte</option>
</select>

            </div>
          </CardContent>
        </Card>


     {/* Section 7: Personal Values */}
        <Card 
          className={`shadow-xl border-l-4 border-pink-500 transition-all duration-500 ${
            currentSection === 7 ? 'form-section active' : 'form-section'
          }`}
          data-section="7"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-pink-500 to-red-500 rounded-full flex items-center justify-center mr-4">
                <Heart className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üå± Valeurs personnelles</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1529390079861-591de354faf5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Jeunes exprimant leurs valeurs personnelles" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="mb-8">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Valeurs phares (notation de 1 √† 5)</h3>
              <p className="text-sm text-gray-600 dark:text-gray-400 mb-6">5 = Tr√®s important, 1 = Pas important</p>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {[
                  { key: "valeur_aventure", label: "üåü Aventure / Exploration" },
                  { key: "valeur_creativite", label: "üé® Cr√©ativit√© / Originalit√©" },
                  { key: "valeur_securite", label: "üõ°Ô∏è S√©curit√© / Stabilit√©" },
                  { key: "valeur_aider", label: "ü§ù Aider les autres / Altruisme" },
                  { key: "valeur_autonomie", label: "ü¶ã Ind√©pendance / Autonomie" },
                  { key: "valeur_curiosite", label: "üß† Apprentissage / Curiosit√©" },
                  { key: "valeur_collaboration", label: "üë• Travail d'√©quipe / Collaboration" },
                  { key: "valeur_reconnaissance", label: "üèÜ Reconnaissance / Statut" },
                  { key: "valeur_equilibre", label: "‚öñÔ∏è √âquilibre vie pro/perso" },
                  { key: "valeur_defis", label: "üöÄ D√©fis / Surpassement de soi" },
                  { key: "valeur_justice", label: "‚öñÔ∏è Justice / √âgalit√©" },
                  { key: "valeur_nature", label: "üåç Respect de la nature" },
                ].map((item) => (
                  <div key={item.key} className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <span className="font-medium">{item.label}</span>
                    <RadioGroup
                      onValueChange={(value) => form.setValue(item.key as any, parseInt(value))}
                      className="flex space-x-1"
                    >
                      {[1, 2, 3, 4, 5].map((num) => (
                        <div key={num} className="flex items-center">
                          <RadioGroupItem value={num.toString()} id={`${item.key}-${num}`} />
                          <Label htmlFor={`${item.key}-${num}`} className="ml-1 text-sm">{num}</Label>
                        </div>
                      ))}
                    </RadioGroup>
                  </div>
                ))}
              </div>
            </div>

            <div>
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Valeurs g√©n√©rales</h3>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {checkboxOptions.valeurs_generales.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`valeurs_generales-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("valeurs_generales") || [];
                        if (checked) {
                          form.setValue("valeurs_generales", [...current, option.value]);
                        } else {
                          form.setValue("valeurs_generales", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`valeurs_generales-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>

     {/* Section 8: Knowledge & Experience */}
        <Card 
          className={`shadow-xl border-l-4 border-indigo-500 transition-all duration-500 ${
            currentSection === 8 ? 'form-section active' : 'form-section'
          }`}
          data-section="8"
        >
          <CardContent className="p-8">
            <div className="flex items-center mb-6">
              <div className="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center mr-4">
                <Book className="text-white h-6 w-6" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">üìö Connaissances & Exp√©riences</h2>
            </div>

            <div className="mb-8">
              <img 
                src="https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=300" 
                alt="Livres et connaissances scolaires" 
                className="w-full h-48 object-cover rounded-lg"
              />
            </div>

            <div className="mb-6">
              <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Domaines de connaissance</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                {checkboxOptions.connaissance.map((option) => (
                  <div key={option.value} className="flex items-center space-x-2">
                    <Checkbox
                      id={`connaissance-${option.value}`}
                      onChange={(checked) => {
                        const current = form.getValues("connaissance") || [];
                        if (checked) {
                          form.setValue("connaissance", [...current, option.value]);
                        } else {
                          form.setValue("connaissance", current.filter(v => v !== option.value));
                        }
                      }}
                    />
                    <Label htmlFor={`connaissance-${option.value}`} className="text-sm">
                      {option.label}
                    </Label>
                  </div>
                ))}
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <Label>As-tu d√©j√† eu une exp√©rience de travail ou de b√©n√©volat ?</Label>
                <Select onValueChange={(value) => form.setValue("experience", value as any)}>
                  <SelectTrigger>
                    <SelectValue placeholder="-- Choisir --" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Oui">‚úÖ Oui</SelectItem>
                    <SelectItem value="Non">‚ùå Non</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              <div>
                <Label htmlFor="experience_details">Pr√©cise ton exp√©rience (si tu en as une)</Label>
                <Textarea
                  id="experience_details"
                  rows={3}
                  placeholder="D√©cris tes exp√©riences de travail, stages, b√©n√©volat..."
                  {...form.register("experience_details")}
                />
              </div>
            </div>
          </CardContent>
        </Card>


     {/* Section 9: Final Summary */}
        <Card 
          className={`shadow-xl gradient-bg text-white transition-all duration-500 ${
            currentSection === 9 ? 'form-section active' : 'form-section'
          }`}
          data-section="9"
        >
          <CardContent className="p-8">
            <div className="text-center mb-8">
              <div className="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <Sparkles className="h-8 w-8" />
              </div>
              <h2 className="text-3xl font-bold mb-2">üéâ Pr√™t(e) pour la magie ?</h2>
              <p className="text-xl opacity-90">Notre IA va analyser ton profil et te proposer des m√©tiers parfaits pour toi !</p>
            </div>

            <div className="text-center">
              <Button
                type="submit"
                disabled={isLoading}
                className="inline-flex items-center px-12 py-4 bg-white text-primary text-xl font-bold rounded-full hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 shadow-lg"
              >
                {isLoading ? (
                  <>
                    <div className="animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent mr-3" />
                    Analyse en cours...
                  </>
                ) : (
                  <>
                    <Rocket className="mr-3 h-5 w-5 animate-bounce-gentle" />
                    D√©couvrir mes m√©tiers de r√™ve !
                    <Sparkles className="ml-3 h-5 w-5" />
                  </>
                )}
              </Button>
            </div>
          </CardContent>
        </Card>
      </form>

      {/* Navigation Controls */}
      <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-4 z-50">
        <Button
          onClick={prevSection}
          disabled={currentSection === 1}
          variant="secondary"
          className="flex items-center px-6 py-3 bg-gray-600 text-white rounded-full hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <ArrowLeft className="mr-2 h-4 w-4" />
          Pr√©c√©dent
        </Button>

        {currentSection < totalSections && (
          <Button
            onClick={nextSection}
            className="flex items-center px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-full hover:from-blue-600 hover:to-green-600 transition-colors"
          >
            Suivant
            <ArrowRight className="ml-2 h-4 w-4" />
          </Button>
        )}
      </div>
    </div> // ‚Üê ferme le bloc principal du return
  );       // ‚Üê ferme le return
}          // ‚Üê ferme la fonction
